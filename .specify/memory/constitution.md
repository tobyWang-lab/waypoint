<!-- 
  Sync Impact Report (v1.0.0 Creation)
  =====================================
  - Initial constitution ratified 2026-01-17
  - Principles: Code Quality, Testing Standards, User Experience, MVP & Anti-Over-Design, Stateless Processing, Integration Flexibility, Error Handling
  - Templates pending validation: plan-template.md, spec-template.md, tasks-template.md
-->

# Wrapoint Constitution

AI Agent for Email & Attachment Analysis and Task Generation

## Core Principles

### I. Code Quality: Modular & Maintainable

Every module must prioritize clarity and reusability. Code MUST follow these standards:
- Single Responsibility Principle: Each function/class has one clear purpose
- No circular dependencies or tight coupling between components
- Clear, documented interfaces between modules (e.g., input validation contracts)
- Code reviews MUST verify modular design before merge
- Complexity in any component must be justified in PR description

**Rationale**: Maintainable code reduces debugging time, enables parallel feature work, and eases onboarding.

### II. Testing Standards: Validation of AI Accuracy & System Stability

Testing is non-negotiable. Requirements:
- **AI Extraction Validation**: Automated tests MUST verify accuracy of LLM task extraction against ground-truth datasets (human-verified examples)
- **Attachment Robustness**: Integration tests MUST cover at least: PDF, image (JPG/PNG), office docs (DOCX, XLSX), plain text
- **Error Resilience**: Tests MUST confirm graceful degradation when file parsing fails or AI response is malformed
- **Unit Coverage**: Core extraction logic (email parsing, attachment handling, task generation) MUST have >80% code coverage
- Test results MUST be reviewed before release; failing tests block merge

**Rationale**: Validates that the core value (accurate task extraction) is delivered reliably across diverse inputs.

### III. User Experience: Consistent Task Categorization & Clear Feedback

Task extraction and status reporting MUST be transparent and predictable:
- All tasks generated by the agent MUST use a standardized category taxonomy (e.g., urgent, followup, blocked, completed)
- Task generation logic MUST be documented; if rules change, changelog MUST be updated and communicated
- Agent processing status (success, partial, failure, skipped) MUST be communicated clearly in simple, non-technical language
- Feedback on why a task was generated or rejected MUST be provided when available

**Rationale**: Users need to understand and trust the agent's decisions; consistency enables workflow automation downstream.

### IV. MVP & Anti-Over-Design: Core Logic First

The project MUST deliver the "Email-to-Todo" conversion pipeline before any secondary features:
- **MVP Scope**: Email ingestion → Attachment list extraction → LLM task generation → Task output (JSON/API)
- **NO Optional**: UI polish, advanced filtering, multi-tenancy, analytics dashboards, or custom rule engines until MVP ships
- **Feature Gate**: All non-core features require Constitution amendment and explicit user requirement
- Avoid premature optimization; measure first before refactoring for performance

**Rationale**: Rapid delivery of core value allows user feedback; feature creep delays market entry and multiplies support surface.

### V. Stateless Processing: Privacy & Data Isolation

Email content and attachments MUST NEVER persist beyond processing:
- No databases storing raw email bodies, attachment files, or sender/recipient metadata (except task output)
- Session/temporary files for attachment processing MUST be encrypted and deleted immediately after analysis
- Logs MUST NOT contain email content or PII; sanitize before storage
- Each invocation operates in isolation; no cross-request state

**Rationale**: Minimizes security surface, eases compliance (GDPR, data residency), reduces infrastructure complexity.

### VI. Integration Flexibility: Standard LLM API/Protocol

LLM interaction MUST use standard APIs to maintain provider agility:
- OpenAI API, Anthropic, or equivalent REST/streaming interfaces are acceptable
- Configuration MUST support provider switching without code changes (environment variable for API endpoint, key rotation)
- Request/response formats MUST be normalized internally; provider-specific quirks hidden in adapter layer
- Fallback logic MUST exist if primary provider is unavailable

**Rationale**: Avoids vendor lock-in; enables cost optimization and model upgrades without re-architecture.

### VII. Error Handling: Graceful Degradation

System MUST remain functional when components fail:
- **Attachment Parsing Failure**: Skip unsupported file types; return partial task list with clear indication
- **LLM Service Unavailable**: Return null/empty task list with error status; do NOT retry indefinitely
- **Email Format Invalid**: Log error, skip message, continue processing batch
- **All Errors**: MUST be categorized (retryable vs. permanent) and logged with context for debugging
- User-facing error messages MUST be actionable (e.g., "Attachment too large (>50MB), retrying with PDF summary" vs. "Error 500")

**Rationale**: Handles real-world chaos; ensures agent doesn't block user workflows due to edge cases.

## Technical Constraints

### Target Environment: n8n

All components MUST be deployable and functional as n8n workflows:
- Workflows MUST be compatible with n8n's workflow execution engine
- All integrations MUST use n8n's built-in nodes or HTTP request capabilities
- Credential management MUST leverage n8n's built-in credential storage
- Workflows MUST be exportable and versioned in n8n's JSON format
- Build and test environments MUST be validated on n8n

**Deployment Gate**: Every feature MUST be tested on n8n before release.

### Privacy: Stateless Processing (see Principle V)

No persistent storage of raw email content, attachment files, or sensitive metadata outside task output.

### Integration: Standard LLM APIs (see Principle VI)

System MUST not be tightly coupled to any single LLM provider.

### Error Handling: Graceful Degradation (see Principle VII)

Unsupported formats, network timeouts, and LLM failures MUST not cascade into system failure.

## Development & Review Workflow

- **Code Review Gate**: Every PR MUST verify compliance with Principles I–VII
- **Testing Gate**: No merge without passing all automated tests (extraction accuracy, attachment robustness, error resilience)
- **Constitution Compliance**: If a feature violates any principle, it MUST be explicitly amended via Constitution update (see Governance)
- **Tech Debt**: Deviations from principles are tracked as tech debt; address in next planning cycle

## Governance

**Constitution Authority**: This document is the source of truth for Wrapoint development practices. No feature, design, or implementation decision overrides these principles without explicit amendment.

**Amendment Procedure**:
1. Open an issue describing the principle to change and rationale (business, technical, or compliance-driven)
2. Include migration plan for existing code that would become non-compliant
3. Require explicit approval from project maintainers before ratification
4. Update version, amend date, and add Sync Impact Report to constitution
5. Update all dependent templates (plan-template.md, spec-template.md, tasks-template.md) if principle-specific gates changed

**Version Strategy** (Semantic Versioning):
- **MAJOR**: Principle removal or backward-incompatible redefinition (e.g., "all services must be distributed" → "services must be serverless")
- **MINOR**: New principle added or material expansion of guidance (e.g., adding a new error handling rule)
- **PATCH**: Clarifications, wording refinements, no change to binding requirements

**Compliance Review**: Every 6 months or after major feature release, audit codebase against constitution. Document deviations and remediation plan.

**Version**: 1.0.0 | **Ratified**: 2026-01-17 | **Last Amended**: 2026-01-17
